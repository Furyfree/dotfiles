#######################################
# ENVIRONMENT VARIABLES
#######################################
export EDITOR=vim
export GTK_THEME=catppuccin-mocha-blue-standard+default
export PATH=$PATH:/usr/local/go/bin:$HOME/.local/bin

# Pyenv
export PYENV_ROOT="$HOME/.pyenv"
export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init --path)"
eval "$(pyenv init -)"
# eval "$(pyenv virtualenv-init -)"  # Uncomment if needed

# Starship
export STARSHIP_CONFIG=$HOME/.config/starship/starship.toml
eval "$(starship init zsh)"

#######################################
# HISTORY CONFIG
#######################################
HISTFILE=~/.zsh_history
HISTSIZE=100000
SAVEHIST=100000

setopt APPEND_HISTORY
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_REDUCE_BLANKS
setopt HIST_VERIFY

#######################################
# ZINIT (PLUGIN MANAGER)
#######################################
if [[ ! -f $HOME/.local/share/zinit/zinit.git/zinit.zsh ]]; then
  echo "Installing Zinit..."
  mkdir -p "$HOME/.local/share/zinit" && chmod g-rwX "$HOME/.local/share/zinit"
  git clone https://github.com/zdharma-continuum/zinit "$HOME/.local/share/zinit/zinit.git" \
    && echo "Zinit installed." || echo "Failed to install Zinit."
fi

source "$HOME/.local/share/zinit/zinit.git/zinit.zsh"
autoload -Uz _zinit
(( ${+_comps} )) && _comps[zinit]=_zinit

# Plugins
zinit light zsh-users/zsh-autosuggestions
zinit light zsh-users/zsh-syntax-highlighting
zinit light zsh-users/zsh-completions
zinit light zsh-users/zsh-history-substring-search
zinit snippet OMZL::git.zsh
zinit snippet OMZP::git
zinit light Aloxaf/fzf-tab

#######################################
# FZF CONFIG
#######################################
[ -f /usr/share/fzf/key-bindings.zsh ] && source /usr/share/fzf/key-bindings.zsh
[ -f /usr/share/fzf/completion.zsh ] && source /usr/share/fzf/completion.zsh

#######################################
# ZOXIDE (better cd)
#######################################
eval "$(zoxide init zsh)"

#######################################
# ALIASES
#######################################

# General tools
alias y='yazi'
alias ls='eza --icons --grid --group-directories-first'
alias ll='eza -lah --icons --group-directories-first'
alias lt='eza --tree --icons --group-directories-first'
alias la='eza -a --icons --grid --group-directories-first'
alias cat='bat'
alias c='clear'
alias e='exit'
alias copy="wl-copy"
alias paste="wl-paste"
alias f='fastfetch'
alias help='tldr'
alias history='history 1'
alias mkdir='mkdir -p'

# Finder and SSH
alias fman='compgen -c | fzf | xargs man'
alias fzf-find='fd --type f | fzf'
alias find='fd'
alias sshkit="TERM=xterm-256color ssh"

# Git
alias gt="git"
alias ga="git add ."
alias gs="git status -s"
alias gc='git commit -m'
alias glog='git log --oneline --graph --all'

# Generic Maven aliases
alias mvn-build='mvn clean package'
alias mvn-run='java -cp target/classes $(grep -oPm1 "(?<=<mainClass>)[^<]+" pom.xml)'
alias mvn-clean='mvn clean'
alias mvn-test='mvn test'
alias mvn-install='mvn install'

# Spring Boot Maven (uses ./mvnw)
alias sb-run='./mvnw spring-boot:run'
alias sb-clean='./mvnw clean'
alias sb-test='./mvnw test'
alias sb-package='./mvnw package'
alias sb-install='./mvnw install'
alias sb-compile='./mvnw compile'

# Docker
alias lg='lazygit'
alias ld='lazydocker'

# Maintenance
alias updategrub='sudo grub-mkconfig -o /boot/grub/grub.cfg'

#######################################
# CUSTOM FUNCTIONS
#######################################
check_timeshift_sizes() {
  MOUNT="/mnt/timeshift"
  DEVICE="/dev/nvme3n1p2"
  sudo mkdir -p "$MOUNT"
  sudo mount "$DEVICE" "$MOUNT" && \
  echo "Timeshift snapshot-størrelser:" && \
  sudo du -sh "$MOUNT/timeshift-btrfs/snapshots/"* && \
  sudo umount "$MOUNT"
}

maintenance() {
  echo "Er du sikker på du vil køre maintenance? ([Y]/n)"
  read confirm
  if [[ "${confirm:l}" == "n" ]]; then
    echo "Annulleret."
  else
    bash ~/maintenance.sh
  fi
}

#######################################
# Completion
#######################################
autoload -Uz compinit
compinit
